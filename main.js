var DataMovies = {
  "detective": [
    {
      "name": "Достать ножи",
      "country": "США, 2019",
      "genre": "Детектив, Комедия, Драма, Криминал",
      "agelimit": "16+",
      "rating": [
        {
          "IMBd": "IMDb: 7.9",
          "Kinopoisk": "Кинопоиск: 8.0"
        }
      ],
      "url": "url('/img/getTheKnives.jpeg')"
    },
    {
      "name": "Черный ящик",
      "country": "Франция, 2020",
      "genre": "Детектив, Триллер",
      "agelimit": "16+",
      "rating": [
        {
          "IMBd": "IMDb: 7.9",
          "Kinopoisk": "Кинопоиск: 7.6"
        }
      ],
      "url": "url('/img/blackBox.jpeg')"
    },
    {
      "name": "Девушка с татуировкой дракона ",
      "country": "США, Швеция, Норвегия 2011",
      "genre": "Детектив, Триллер, Драма, Криминал",
      "agelimit": "18+",
      "rating": [
        {
          "IMBd": "IMDb: 7.1",
          "Kinopoisk": "Кинопоиск: 7.7"
        }
      ],
      "url": "url('/img/girl.jpeg')"
    },
    {
      "name": "Бэтмен",
      "country": "США, 2022",
      "genre": "Детектив, Криминал, Драма, Боевик",
      "agelimit": "16+",
      "rating": [
        {
          "IMBd": "IMDb: 7.6",
          "Kinopoisk": "Кинопоиск: 7.9"
        }
      ],
      "url": "url('/img/batman.jpeg')"
    }
  ],
  "fantasy": [
    {
      "name": "Аватар",
      "country": "США, 2009",
      "genre": "Фантастика, Боевик, Драма, Приключения",
      "agelimit": "12+",
      "rating": [
        {
          "IMBd": "IMDb: 7.8",
          "Kinopoisk": "Кинопоиск: 8.0"
        }
      ],
      "url": "url('/img/avatar.jpeg')"
    },
    {
      "name": "Начало",
      "country": "США, Великобритания, 2010",
      "genre": "Фантастика, Боевик, Триллер, Детектив",
      "agelimit": "12+",
      "rating": [
        {
          "IMBd": "IMDb: 8.8",
          "Kinopoisk": "Кинопоиск: 8.7"
        }
      ],
      "url": "url('/img/inception.jpeg')"
    },
    {
      "name": "Интерстеллар",
      "country": "США, Великобритания, Канада, 2014",
      "genre": "Фантастика, Драма, Приключения",
      "agelimit": "16+",
      "rating": [
        {
          "IMBd": "IMDb: 8.6",
          "Kinopoisk": "Кинопоиск: 8.6"
        }
      ],
      "url": "url('/img/Interstellar.jpeg')"
    }
  ],
  "action": [
    {
      "name": "Гнев человеческий",
      "country": "Великобритания, США, 2021",
      "genre": "Боевик, Триллер",
      "agelimit": "18+",
      "rating": [
        {
          "IMBd": "IMDb: 7.1",
          "Kinopoisk": "Кинопоиск: 7.6"
        }
      ],
      "url": "url('/img/wrathOfMan.jpeg')"
    },
    {
      "name": "Брат 2",
      "country": "Россия, США, 2000",
      "genre": "Боевик, Криминал",
      "agelimit": "16+",
      "rating": [
        {
          "IMBd": "IMDb: 7.8",
          "Kinopoisk": "Кинопоиск: 8.2"
        }
      ],
      "url": "url('/img/brother.jpeg')"
    },
    {
      "name": "Шерлок Холмс",
      "country": "США, 2022",
      "genre": "Боевик, Приключения, Триллер, Комедия",
      "agelimit": "12+",
      "rating": [
        {
          "IMBd": "IMDb: 7.6",
          "Kinopoisk": "Кинопоиск: 8.1"
        }
      ],
      "url": "url('/img/SherlockHolmes.jpeg')"
    }
  ],
  "forKids": [
    {
      "name": "Один дома",
      "country": "США, 1990",
      "genre": "Комедия, Семейный",
      "agelimit": "0+",
      "rating": [
        {
          "IMBd": "IMDb: 7.7",
          "Kinopoisk": "Кинопоиск: 8.3"
        }
      ],
      "url": "url('/img/HomeAlone.jpeg')"
    },
    {
      "name": "Назад в будущее",
      "country": "США, 1985",
      "genre": "Фантастика, Комедия, Приключения",
      "agelimit": "12+",
      "rating": [
        {
          "IMBd": "IMDb: 8.5",
          "Kinopoisk": "Кинопоиск: 8.6"
        }
      ],
      "url": "url('/img/BackToTheFuture.jpeg')"
    },
    {
      "name": "Гарри Поттер и философский камень",
      "country": "США, Великобритания, 2001",
      "genre": "Фэнтези, Приключения, Семейный",
      "agelimit": "12+",
      "rating": [
        {
          "IMBd": "IMDb: 7.3",
          "Kinopoisk": "Кинопоиск: 8.2"
        }
      ],
      "url": "url('/img/HarryPotter.jpeg')"
    }
  ],
  "comedy": [
    {
      "name": "Круэлла",
      "country": "США, Великобритания, 2021",
      "genre": "Комедия, Криминал, Драма",
      "agelimit": "12+",
      "rating": [
        {
          "IMBd": "IMDb: 7.3",
          "Kinopoisk": "Кинопоиск: 7.5"
        }
      ],
      "url": "url('/img/Cruella.jpeg')"
    },
    {
      "name": "Отель Гранд Будапешт",
      "country": "США, Германия, 2014",
      "genre": "Комедия, Приключения, Детектив, Криминал",
      "agelimit": "16+",
      "rating": [
        {
          "IMBd": "IMDb: 8.4",
          "Kinopoisk": "Кинопоиск: 7.9"
        }
      ],
      "url": "url('/img/TheGrandBudapestHotel.jpeg')"
    },
    {
      "name": "Лулу и Бриггс",
      "country": "США, 2021",
      "genre": "Комедия, Драма, Приключения",
      "agelimit": "12+",
      "rating": [
        {
          "IMBd": "IMDb: 6.5",
          "Kinopoisk": "Кинопоиск: 7.4"
        }
      ],
      "url": "url('/img/Dog.jpeg')"
    }
  ],
  "melodrama": [
    {
      "name": "Титаник",
      "country": "США, Мексика, 1997",
      "genre": "Мелодрама, История, Триллер, Драма",
      "agelimit": "12+",
      "rating": [
        {
          "IMBd": "IMDb: 7.9",
          "Kinopoisk": "Кинопоиск: 8.4"
        }
      ],
      "url": "url('/img/Titanic.jpeg')"
    },
    {
      "name": "Стажёр",
      "country": "США, 2015",
      "genre": "Мелодрама, Комедия",
      "agelimit": "16+",
      "rating": [
        {
          "IMBd": "IMDb: 7.1",
          "Kinopoisk": "Кинопоиск: 7.6"
        }
      ],
      "url": "url('/img/TheIntern.jpeg')"
    },
    {
      "name": "Укрощение строптивого",
      "country": "Италия, 1980",
      "genre": "Мелодрама, Комедия",
      "agelimit": "12+",
      "rating": [
        {
          "IMBd": "IMDb: 7.6",
          "Kinopoisk": "Кинопоиск: 8.4"
        }
      ],
      "url": "url('/img/IlBisbeticoDomato.jpeg')"
    }
  ],
  "adventure": [
    {
      "name": "Выживший",
      "country": "США, Гонконг, Тайвань, 2015",
      "genre": "Приключения, Вестерн, Боевик, Драма, Биография",
      "agelimit": "18+",
      "rating": [
        {
          "IMBd": "IMDb: 8.0",
          "Kinopoisk": "Кинопоиск: 7.8"
        }
      ],
      "url": "url('/img/TheRevenant.jpeg')"
    },
    {
      "name": "Парк Юрского периода",
      "country": "США, 1993",
      "genre": "Приключения, Фантастика, Семейный",
      "agelimit": "16+",
      "rating": [
        {
          "IMBd": "IMDb: 8.2",
          "Kinopoisk": "Кинопоиск: 7.8"
        }
      ],
      "url": "url('/img/JurassicPark.jpeg')"
    },
    {
      "name": "Восточный ветер",
      "country": "США, 2013",
      "genre": "Приключения, Семейный, Драма",
      "agelimit": "12+",
      "rating": [
        {
          "IMBd": "IMDb: 6.7",
          "Kinopoisk": "Кинопоиск: 8.1"
        }
      ],
      "url": "url('/img/Ostwind.jpeg')"
    }
  ]

}

var DataGenre = {
  "detective": "Детектив",
  "fantasy": "Фантастика",
  "action": "Боевик",
  "forKids": "Для детей",
  "comedy": "Комедия",
  "melodrama": "Мелодрама",
  "adventure": "Приключения"
}

var moviesDivContener = document.getElementById('movies')
var categoriesDivContainer = document.getElementById('categories');

//смещение фокуса
document.addEventListener('keydown', changeFocus);
function changeFocus(e) {
  var headers = document.getElementsByClassName('header__item');
  var films = document.getElementsByClassName('btn_movies');
  var categ = document.getElementsByClassName('btn_categories');

  var htmlCollec = [headers, categ, films];
  var arrayFocusableElem = [];
  var indexCol = -1;
  var indexRow = -1;

  for (var i = 0; i < htmlCollec.length; i++) {
    var array = [];
    for (var j = 0; j < htmlCollec[i].length; j++) {
      array.push(htmlCollec[i][j]);
    }
    arrayFocusableElem.push(array);
    if (indexCol === -1) {
      indexCol = array.indexOf(document.activeElement);
      indexRow = i;
    }
    else if (indexRow === -1) {
      indexRow = array.indexOf(document.activeElement);
      indexCol = j;
    }
  }

  var nextIndexCol = 0;
  var nextIndexRow = 0;

  //влево
  if (e.keyCode === 37) {
    nextIndexCol = indexCol > 0 ? indexCol - 1 : 0;
    arrayFocusableElem[indexRow][nextIndexCol].focus();
    arrayFocusableElem[indexRow][nextIndexCol].click();
  }
  //вправо
  else if (e.keyCode === 39) {
    nextIndexCol = indexCol < arrayFocusableElem[indexRow].length ? indexCol + 1 : arrayFocusableElem[indexRow].length;
    arrayFocusableElem[indexRow][nextIndexCol].focus();
    arrayFocusableElem[indexRow][nextIndexCol].click();
  }

  //вверх
  else if (e.keyCode === 38) {
    nextIndexRow = indexRow > 0 ? indexRow - 1 : 0;
    arrayFocusableElem[nextIndexRow][indexCol].focus();
    arrayFocusableElem[nextIndexRow][indexCol].click();
  }
  //вниз
  else if (e.keyCode === 40) {
    nextIndexRow = indexRow < arrayFocusableElem[indexCol].length ? indexRow + 1 : arrayFocusableElem[indexCol].length;
    arrayFocusableElem[nextIndexRow][indexCol].focus();
    arrayFocusableElem[nextIndexRow][indexCol].click();
  }
}

//функция заполнения описания фильмов
function setDescripltionFilm(genreName) {
  moviesDivContener.innerHTML = '';
  var tabNameMovies = document.createElement('div');
  var test = document.createElement('div');
  var mainMovies = document.createElement('div');
  var tabDescrMovies = document.createElement('div');

  // контейнер с описанием фильма 
  for (let filmInfo in DataMovies[genreName]) {
    let filmName = document.createElement('input');
    tabNameMovies.appendChild(filmName).type = 'button';
    filmName.id = 'film_name_' + String(filmInfo);
    filmName.className = 'btn_movies';
    filmName.style.backgroundImage = DataMovies[genreName][filmInfo].url;

    filmName.onclick = function () {
      // var mov = document.getElementsByClassName('btn_movies');
      // var arrMov = [mov];
      
      // var width = filmName.offsetWidth;
    
      // for (var i = 0; i < arrMov.length; i++) {
      //   if (arrMov[i] !== -1) {
      //     filmName.style.right = width + 400 + 'px';
      //   }
      // }


      let itemsMoviesActive = document.getElementsByClassName('btn_movies-active');
      if (itemsMoviesActive.length > 0) {
        for (let i = 0; i < itemsMoviesActive.length; i++) {
          itemsMoviesActive[i].className = 'btn_movies';
        }
      }
      filmName.className += ' btn_movies-active';

      document.body.style.backgroundImage = DataMovies[genreName][filmInfo].url;

      tabDescrMovies.innerHTML = ''
      var innerList = document.createElement('ul');
      var innerTitle = document.createElement('h2');
      var filmInfoCountry = document.createElement('li');
      var filmInfoGenre = document.createElement('li');
      var filmInfoAge = document.createElement('li');
      var filmInfoIBMd = document.createElement('li');
      var filmInfoKinopoisk = document.createElement('li');

      innerTitle.innerHTML = DataMovies[genreName][filmInfo].name;
      tabDescrMovies.appendChild(innerTitle).className = 'inner__title';

      filmInfoCountry.innerHTML = DataMovies[genreName][filmInfo].country;
      filmInfoGenre.innerHTML = DataMovies[genreName][filmInfo].genre;
      filmInfoAge.innerHTML = DataMovies[genreName][filmInfo].agelimit;
      innerList.appendChild(filmInfoCountry).className = 'inner__item';
      innerList.appendChild(filmInfoGenre).className = 'inner__item';
      innerList.appendChild(filmInfoAge).className = 'inner__item';
      innerList.appendChild(filmInfoAge).className += ' ageLimit';

      for (let ratingInfo in DataMovies[genreName][filmInfo].rating) {
        filmInfoIBMd.innerHTML = DataMovies[genreName][filmInfo].rating[ratingInfo].IMBd;
        filmInfoKinopoisk.innerHTML = DataMovies[genreName][filmInfo].rating[ratingInfo].Kinopoisk;
        innerList.appendChild(filmInfoIBMd).className = 'inner__item';
        innerList.appendChild(filmInfoIBMd).className += ' rating';
        innerList.appendChild(filmInfoKinopoisk).className = 'inner__item';
        innerList.appendChild(filmInfoKinopoisk).className += ' rating';
      }
      tabDescrMovies.appendChild(innerList).className = 'inner__list';
      tabDescrMovies.appendChild(innerList).className += ' list-reset';
    }
    mainMovies.appendChild(tabDescrMovies).id = 'tab_descr_movies';
    if (filmName.id === 'film_name_0') {
      filmName.click();
      filmName.className += ' btn_movies-active';
    }
  }
  moviesDivContener.appendChild(test).id = 'test';
  test.appendChild(tabNameMovies).id = 'tabName_movies';
  moviesDivContener.appendChild(mainMovies).id = 'mainMovies';
}

// основная функция - заполенение категорий фильмов
function setCategories() {
  categoriesDivContainer.innerHTML = '';

  for (let genreName in DataGenre) {
    let btn = document.createElement('button');
    btn.innerHTML = DataGenre[genreName];
    btn.id = 'btn_' + String(genreName);
    btn.className = 'btn_categories';

    btn.onclick = function () {
      //делаем кнопку активной по нажатию
      var itemsGenreActive = document.getElementsByClassName('btn_categories-active');
      if (itemsGenreActive.length > 0) {
        for (var i = 0; i < itemsGenreActive.length; i++) {
          itemsGenreActive[i].className = 'btn_categories';
        }
      }
      btn.className += ' btn_categories-active';

      // заполнение  div movies
      setDescripltionFilm(genreName);
    }
    categoriesDivContainer.appendChild(btn);
    //делаем кнопку активной после загрузки
    if (btn.id === 'btn_detective') {
      btn.click();
      btn.className += ' btn_categories-active';
    }
  }

}

setCategories();

window.onload = function () {
  document.body.className = 'loaded__hiding';
  window.setTimeout(function () {
    document.body.className = 'loaded';
  }, 500);
}